const e=e=>Object.fromEntries(Object.entries(e).filter(([,e])=>null!=e)),t=(e,t)=>{Object.keys(t).map(s=>{if(e.type===s){if(!e.className&&!e.id)throw Error(`Please provide a class or id for element: ${e.type}`);if(e.className){let i=document.querySelector("."+e.className);if(i)t[s]=i;else throw Error(`Could not find element with className: ${e.className}`)}if(e.id){let i=document.getElementById(e.id);if(i)t[s]=i;else throw Error(`Could not find element with id: ${e.id}`)}}})};function s(e){if(Object.keys(e).length<=0)throw Error("Error: no coords exist on this object");Object.entries(e).forEach(([e,t])=>{if("number"!=typeof t)throw Error(`Error type ${e}:${t} must be of type number`)})}function i(e,t,s){return"increment"===t?e+s:e-s}const o=(e,t,s)=>{let i=document.createElement(e);return s&&Object.keys(s).forEach(e=>{Reflect.set(i.style,e,s[e])}),t.appendChild(i),i};function r(e,t){return t?s(e.resizedCoords):s(e.coords),"line"===e.type?{startX:t?e.resizedCoords.resizedStartX:e.coords.startX,startY:t?e.resizedCoords.resizedStartY:e.coords.startY,endX:t?e.resizedCoords.resizedEndX:e.coords.endX,endY:t?e.resizedCoords.resizedEndY:e.coords.endY}:{x1:t?e.resizedCoords.resizedX1:e.coords.x1,y1:t?e.resizedCoords.resizedY1:e.coords.y1,x2:t?e.resizedCoords.resizedX2:e.coords.x2,y2:t?e.resizedCoords.resizedY2:e.coords.y2}}class n{canvas;context;controller=document.getElementById("toolbar");tools={pencil:document.getElementById("pencil"),eraser:document.getElementById("eraser"),moveAndResize:document.getElementById("mv-rz"),text:document.getElementById("text"),line:document.getElementById("line")};toolModifiers={color:document.getElementById("color"),width:document.getElementById("lineWidth")};canvasModifiers={clear:document.getElementById("clear"),undo:document.getElementById("undo")};actions={drawing:!1,erasing:!1,moving:!1,resizing:!1,writing:!1,lining:!1};shouldDraw=!1;shouldErase=!1;shouldMove=!1;shouldResize={toggled:!1,from:""};shouldLine=!1;activeTools={pencil:!1,eraser:!1,moveAndResize:!1,text:!1,line:!1};mouseIsDown=!1;isDragging=!1;index=-1;selectedDrawingIndex=null;pathObject={type:"stroke",path:new Path2D,resizedPath:null,lineWidth:5,strokeStyle:"black",operation:"source-over",coords:{},resizedCoords:{},xCords:[],yCords:[],resizedXCords:[],resizedYCords:[]};textObject={type:"text",text:"",font:"30pt sans-serif",resizedFont:"",baseline:"top",operation:"source-over",coords:{},resizedCoords:{}};lineObject={type:"line",path:new Path2D,resizedPath:null,lineWidth:5,strokeStyle:"black",operation:"source-over",coords:{},resizedCoords:{}};drawingData=[];startX=0;startY=0;mouseX=0;mouseY=0;selectedTool={};constructor(e,s){let i=document.getElementById(e),o=i.getContext("2d");s?.elements?.forEach(e=>{t(e,this.tools),t(e,this.toolModifiers),t(e,this.canvasModifiers)}),s?.width?i.width=s.width:i.width=window.innerWidth-i.offsetLeft,s?.height?i.height=s.height:i.height=window.innerHeight-i.offsetTop,this.canvas=i,this.context=o,this.canvas.style.cursor="crosshair",this.tools.pencil&&(this.selectedTool.element=this.tools.pencil,this.selectedTool.name="pencil"),this.selectedTool.element?.classList.add("active"),this.activeTools[this.selectedTool.name]=!0,this.listen()}listen(){let e=this.canvas,t=this.controller;e.addEventListener("mousedown",this.pressDownHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("mousemove",this.mouseMoveHandler),e.addEventListener("touchstart",this.pressDownHandler),e.addEventListener("touchend",this.mouseUpHandler),e.addEventListener("touchmove",this.mouseMoveHandler),t?.addEventListener("change",this.changeHandler),t?.addEventListener("click",this.toolSelectHandler)}changeHandler=e=>{let t=e.target,s=this.toolModifiers.color,i=this.toolModifiers.width;s&&this.targetIs(s,t)&&(this.pathObject.strokeStyle=t.value),i&&this.targetIs(i,t)&&(this.pathObject.lineWidth=Number(t.value))};toolSelectHandler=t=>{this.selectedDrawingIndex=null;let s=t.target,i=this.context,o=e(this.tools),r=e(this.canvasModifiers);Object.keys(o).length>0&&(Object.entries(o).forEach(([e,t])=>{t===s?(this.selectedTool.element=t,this.selectedTool.name=e):(this.activeTools[e]=!1,t?.classList.remove("active"))}),this.selectedTool.element?.classList.add("active"),this.activeTools[this.selectedTool.name]=!0,"pencil"===this.selectedTool.name||"eraser"===this.selectedTool.name||"line"===this.selectedTool.name?this.canvas.style.cursor="crosshair":"text"===this.selectedTool.name?this.canvas.style.cursor="text":this.canvas.style.cursor="default"),Object.keys(r).length>0&&(r.clear===s&&(i.clearRect(0,0,this.canvas.width,this.canvas.height),this.index=-1,this.drawingData=[]),r.undo===s&&(this.index<=0?(i.clearRect(0,0,this.canvas.width,this.canvas.height),this.index=-1,this.drawingData=[]):(this.index-=1,this.drawingData.pop(),this.redraw(this.drawingData))))};pressDownHandler=e=>{if(this.mouseIsDown=!0,this.actions.writing)return;let t=e.touches?e.touches[0]:e,{pencil:s,eraser:r,moveAndResize:n,text:d,line:a}=this.activeTools,h=t.clientY-this.canvas.offsetTop,c=t.clientX-this.canvas.offsetLeft;if(this.startX=c,this.startY=h,r&&(this.pathObject.operation="destination-out",this.shouldErase=!0,this.addCoords(c,h,!1)),s&&(this.pathObject.operation="source-over",this.shouldDraw=!0,this.addCoords(c,h,!1)),n){if(this.drawingData.length<=0)return;if(null!==this.selectedDrawingIndex){let e=this.drawingData[this.selectedDrawingIndex],t=this.mouseWithinSelection(c,h,e);t?"middle"===t?this.shouldMove=!0:(this.shouldResize.toggled=!0,this.shouldResize.from=t):this.selectedDrawingIndex=null}this.drawingData.forEach((e,t)=>{if("stroke"===e.type||"line"===e.type){if(this.context.isPointInStroke(e.path,c,h)){this.selectedDrawingIndex=t;let e=this.drawingData[this.selectedDrawingIndex],s=this.mouseWithinSelection(c,h,e);"middle"===s?this.shouldMove=!0:(this.shouldResize.toggled=!0,this.shouldResize.from=s)}}else if(this.mouseWithinSelection(c,h,e)){this.selectedDrawingIndex=t;let e=this.drawingData[this.selectedDrawingIndex],s=this.mouseWithinSelection(c,h,e);"middle"===s?this.shouldMove=!0:(this.shouldResize.toggled=!0,this.shouldResize.from=s)}})}if(d){let e=document.querySelector(".drawing-board"),s=o("input",e,{position:"fixed",top:`${t.clientY}px`,left:`${t.clientX}px`,outline:"none",background:"none",border:"none","font-size":"30pt","font-family":"sans-serif"});this.actions.writing=!0,window.setTimeout(()=>s.focus(),0),s.addEventListener("blur",()=>{this.redraw(this.drawingData),this.textObject.text=s.value,this.setCtxStyles(this.textObject);let t=this.context.measureText(s.value).width,o=parseInt(this.context.font);this.textObject.coords={x1:c,y1:h,x2:Math.round(c+t),y2:Math.round(h+o)},this.context.fillText(this.textObject.text,c,h),this.index=i(this.index,"increment",1),this.drawingData.push(this.textObject),e.removeChild(s),this.actions.writing=!1,this.textObject={type:"text",text:"",font:"30pt sans-serif",resizedFont:"",baseline:"top",operation:"source-over",coords:{},resizedCoords:{}}}),s.addEventListener("keypress",e=>{"Enter"===e.key&&s.blur()}),e?.appendChild(s)}if(a){if(this.actions.lining)return;this.lineObject.operation="source-over",this.shouldLine=!0,this.lineObject.path.moveTo(c,h),this.lineObject.coords={startX:c,startY:h}}};mouseUpHandler=()=>{if(this.mouseIsDown=!1,this.shouldMove=!1,this.actions.moving=!1,this.actions.drawing||this.actions.erasing){if(this.shouldDraw=!1,this.shouldErase=!1,this.actions.drawing=!1,this.actions.erasing=!1,1===this.pathObject.xCords.length){this.pathObject={type:"stroke",path:new Path2D,resizedPath:null,lineWidth:this.context.lineWidth,strokeStyle:String(this.context.strokeStyle),operation:"source-over",coords:{},resizedCoords:{},xCords:[],yCords:[],resizedXCords:[],resizedYCords:[]};return}this.pathObject.coords={x1:Math.min(...this.pathObject.xCords),y1:Math.min(...this.pathObject.yCords),x2:Math.max(...this.pathObject.xCords),y2:Math.max(...this.pathObject.yCords)},this.index=i(this.index,"increment",1),this.drawingData.push(this.pathObject),this.pathObject={type:"stroke",path:new Path2D,resizedPath:null,lineWidth:this.context.lineWidth,strokeStyle:String(this.context.strokeStyle),operation:"source-over",coords:{},resizedCoords:{},xCords:[],yCords:[],resizedXCords:[],resizedYCords:[]}}if(this.actions.resizing&&(this.shouldResize={toggled:!1,from:""},this.actions.resizing=!1,null!==this.selectedDrawingIndex)){let e=this.drawingData[this.selectedDrawingIndex];this.updateToResized(e)}this.actions.lining&&(this.shouldLine=!1,this.actions.lining=!1,this.lineObject.coords.endX=this.mouseX,this.lineObject.coords.endY=this.mouseY,this.lineObject.path.lineTo(this.mouseX,this.mouseY),this.index=i(this.index,"increment",1),this.drawingData.push(this.lineObject),this.lineObject={type:"line",path:new Path2D,resizedPath:null,lineWidth:5,strokeStyle:"black",operation:"source-over",coords:{},resizedCoords:{}}),this.redraw(this.drawingData)};mouseMoveHandler=e=>{let t=e.touches?e.touches[0]:e,i=t.clientX-this.canvas.offsetLeft,o=t.clientY-this.canvas.offsetTop;if(this.mouseX=i,this.mouseY=o,this.mouseIsDown?this.isDragging=!0:this.isDragging=!1,this.activeTools.moveAndResize&&(this.canvas.style.cursor="default",this.drawingData.forEach((e,t)=>{switch(e.type){case"stroke":if(this.context.isPointInStroke(e.path,i,o)&&(this.canvas.style.cursor="move"),this.selectedDrawingIndex===t&&this.mouseWithinSelection(i,o,e)){let t=this.mouseWithinSelection(i,o,e);"middle"===t?this.canvas.style.cursor="move":"top-left"===t||"bottom-right"===t?this.canvas.style.cursor="nwse-resize":this.canvas.style.cursor="nesw-resize"}break;case"text":if(this.mouseWithinSelection(i,o,e)){let t=this.mouseWithinSelection(i,o,e);"middle"===t?this.canvas.style.cursor="move":"top-left"===t||"bottom-right"===t?this.canvas.style.cursor="nwse-resize":this.canvas.style.cursor="nesw-resize"}break;case"line":if(this.mouseWithinSelection(i,o,e)){let t=this.mouseWithinSelection(i,o,e);"middle"===t?this.canvas.style.cursor="move":this.canvas.style.cursor="pointer"}}})),null!==this.selectedDrawingIndex&&this.isDragging){let e=i-this.startX,t=o-this.startY,r=this.drawingData[this.selectedDrawingIndex];switch(s(r.coords),r.type){case"stroke":if(this.shouldMove){this.actions.moving=!0;for(let s=0;s<r.xCords.length;s++)r.xCords[s]+=e,r.yCords[s]+=t;r.coords.x1=Math.min(...r.xCords),r.coords.y1=Math.min(...r.yCords),r.coords.x2=Math.max(...r.xCords),r.coords.y2=Math.max(...r.yCords);let s=new Path2D,n=new DOMMatrix().translate(e,t);s.addPath(r.path,n),r.path=s,this.startX=i,this.startY=o}else{let e=this.shouldResize.from;this.actions.resizing=!0;let{scaleOriginXPos:t,scaleOriginYPos:s,scale:n}=this.getScaleInfo(e,r,i,o),d=new Path2D,a=[...r.xCords],h=[...r.yCords],c=[],l=[];for(let e=0;e<r.xCords.length;e++)c[e]=t-r.xCords[e],l[e]=s-r.yCords[e];for(let e=0;e<a.length;e++){let i=c[e]*n,o=l[e]*n;a[e]=t-i,h[e]=s-o,d.moveTo(a[e-1],h[e-1]),d.lineTo(a[e],h[e])}r.resizedCoords.resizedX1=Math.min(...a),r.resizedCoords.resizedY1=Math.min(...h),r.resizedCoords.resizedX2=Math.max(...a),r.resizedCoords.resizedY2=Math.max(...h),r.resizedXCords=a,r.resizedYCords=h,r.resizedPath=d}break;case"text":if(this.shouldMove)this.actions.moving=!0,r.coords.x1+=e,r.coords.y1+=t,r.coords.x2+=e,r.coords.y2+=t,this.startX=i,this.startY=o;else{let e=this.shouldResize.from;this.actions.resizing=!0;let{scaleOriginXPos:t,scaleOriginYPos:s,startCornerXPos:n,startCornerYPos:d,scale:a}=this.getScaleInfo(e,r,i,o),h=r.font.slice(),c=parseFloat(h),l=(t-n)*a,u=(s-d)*a,g=h.replace(c.toString(),(c*a).toString());"top-left"===e||"bottom-left"===e?(r.resizedCoords.resizedX1=t-l,r.resizedCoords.resizedX2=t):(r.resizedCoords.resizedX1=t,r.resizedCoords.resizedX2=t-l),"top-left"===e||"top-right"===e?(r.resizedCoords.resizedY1=s-u,r.resizedCoords.resizedY2=s):(r.resizedCoords.resizedY1=s,r.resizedCoords.resizedY2=s-u),r.resizedFont=g}break;case"line":if(this.shouldMove){this.actions.moving=!0,r.coords.startX+=e,r.coords.startY+=t,r.coords.endX+=e,r.coords.endY+=t;let s=new Path2D,n=new DOMMatrix().translate(e,t);s.addPath(r.path,n),r.path=s,this.startX=i,this.startY=o}else{let e=this.shouldResize.from;this.actions.resizing=!0;let{scaleOriginXPos:t,scaleOriginYPos:s,startCornerXPos:n,startCornerYPos:d}=this.getScaleInfo(e,r,i,o),a=new Path2D;n===r.coords.startX?(r.resizedCoords.resizedStartX=i,r.resizedCoords.resizedEndX=t):(r.resizedCoords.resizedStartX=t,r.resizedCoords.resizedEndX=i),d===r.coords.startY?(r.resizedCoords.resizedStartY=o,r.resizedCoords.resizedEndY=s):(r.resizedCoords.resizedStartY=s,r.resizedCoords.resizedEndY=o),this.context.beginPath(),a.moveTo(i,o),a.lineTo(t,s),r.resizedPath=a}}this.redraw(this.drawingData)}(this.shouldDraw&&this.isDragging||this.shouldErase&&this.isDragging)&&(this.shouldDraw?this.actions.drawing=!0:this.actions.drawing=!1,this.shouldErase?this.actions.erasing=!0:this.actions.erasing=!1,this.redraw(this.drawingData),this.setCtxStyles(this.pathObject),this.addCoords(i,o,!0),this.pathObject.path.lineTo(i,o),this.context.stroke(this.pathObject.path)),this.shouldLine&&(this.actions.lining=!0,this.redraw(this.drawingData),this.setCtxStyles(this.lineObject),this.context.beginPath(),this.context.moveTo(this.lineObject.coords.startX,this.lineObject.coords.startY),this.context.lineTo(i,o),this.context.closePath(),this.context.stroke()),e.preventDefault()};updateToResized(e){"stroke"===e.type?(e.xCords=e.resizedXCords,e.yCords=e.resizedYCords,e.coords.x1=Math.min(...e.xCords),e.coords.y1=Math.min(...e.yCords),e.coords.x2=Math.max(...e.xCords),e.coords.y2=Math.max(...e.yCords),e.path=e.resizedPath):"text"===e.type?(e.coords.x1=e.resizedCoords.resizedX1,e.coords.y1=e.resizedCoords.resizedY1,e.coords.x2=e.resizedCoords.resizedX2,e.coords.y2=e.resizedCoords.resizedY2,e.font=e.resizedFont):(e.coords.startX=e.resizedCoords.resizedStartX,e.coords.endX=e.resizedCoords.resizedEndX,e.coords.startY=e.resizedCoords.resizedStartY,e.coords.endY=e.resizedCoords.resizedEndY,e.path=e.resizedPath)}addCoords(e,t,s){this.pathObject.xCords.push(e),this.pathObject.yCords.push(t),this.isDragging=s}getScaleInfo(e,t,i,o){if(s(t.coords),"line"===t.type){let s="start"===e?t.coords.startX:t.coords.endX,i="start"===e?t.coords.startY:t.coords.endY,o="start"===e?t.coords.endX:t.coords.startX,r="start"===e?t.coords.endY:t.coords.startY;return{scaleOriginXPos:o,scaleOriginYPos:r,startCornerXPos:s,startCornerYPos:i,scale:0}}{let s=e.includes("left")?t.coords.x1:t.coords.x2,r=e.includes("top")?t.coords.y1:t.coords.y2,n=e.includes("left")?t.coords.x2:t.coords.x1,d=e.includes("top")?t.coords.y2:t.coords.y1,a=e.includes("left")?n-s:s-n+(e.includes("top")?d-r:r-d),h=e.includes("left")?n-i:i-n+(e.includes("top")?d-o:o-d);return{scaleOriginXPos:n,scaleOriginYPos:d,startCornerXPos:s,startCornerYPos:r,scale:h/a}}}mouseWithinSelection(e,t,i){let o;if(s(i.coords),"line"===i.type){let{startX:s,endX:r,startY:n,endY:d}=i.coords;o=this.mouseWithin(s-10,s+10,n-10,n+10,e,t)?"start":this.mouseWithin(r-10,r+10,d-10,d+10,e,t)?"end":this.context.isPointInStroke(i.path,e,t)?"middle":""}else{let{x1:s,y1:r,x2:n,y2:d}=i.coords,a=s-10,h=s+10,c=r-10,l=r+10,u=n-10,g=n+10,x=r-10,m=r+10,z=n-10,p=n+10,y=d-10,f=d+10,w=s-10,C=s+10,v=d-10,b=d+10;o=this.mouseWithin(a,h,c,l,e,t)?"top-left":this.mouseWithin(u,g,x,m,e,t)?"top-right":this.mouseWithin(z,p,y,f,e,t)?"bottom-right":this.mouseWithin(w,C,v,b,e,t)?"bottom-left":this.mouseWithin(s,n,r,d,e,t)?"middle":""}return o}createDrawingSelection(e){if(this.context.globalCompositeOperation="source-over",this.context.strokeStyle="#738FE5",this.context.lineWidth=1,"stroke"===e.type||"text"===e.type){let t=r(e,this.actions.resizing),s=t.x2-t.x1,i=t.y2-t.y1;this.context.strokeRect(t.x1,t.y1,s,i),this.drawCornerPoints(e)}else{let t=r(e,this.actions.resizing);this.context.lineWidth=1,this.context.moveTo(t.startX,t.startY),this.context.lineTo(t.endX,t.endY),this.context.stroke(),this.drawCornerPoints(e)}}drawCornerPoints(e){let t,s;if(this.context.lineWidth=5,"stroke"===e.type||"text"===e.type){let i=r(e,this.actions.resizing);for(let e=0;e<4;e++)0===e?(t=i.x1,s=i.y1):1===e?(t=i.x2,s=i.y1):(t=2===e?i.x1:i.x2,s=i.y2),this.context.beginPath(),this.context.arc(t,s,1,0,2*Math.PI),this.context.stroke()}else{let i=r(e,this.actions.resizing);for(let e=0;e<2;e++)0===e?(t=i.startX,s=i.startY):(t=i.endX,s=i.endY),this.context.beginPath(),this.context.arc(t,s,1,0,2*Math.PI),this.context.stroke()}}mouseWithin(e,t,s,i,o,r){return o>=e&&o<=t&&r>=s&&r<=i}setCtxStyles(e){this.context.globalCompositeOperation=e.operation,this.context.lineCap="round","stroke"===e.type||"line"===e.type?(this.context.lineWidth=e.lineWidth,this.context.strokeStyle=e.strokeStyle):"text"===e.type&&(this.context.textBaseline=e.baseline,this.context.font=e.font)}redraw(e){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),e.length<=0||e.forEach((e,t)=>{switch(e.type){case"stroke":if(this.selectedDrawingIndex===t){if(this.actions.resizing){this.setCtxStyles(e),this.context.stroke(e.resizedPath),this.createDrawingSelection(e);return}this.createDrawingSelection(e)}this.setCtxStyles(e),this.context.stroke(e.path);break;case"text":if(this.selectedDrawingIndex===t){if(this.actions.resizing){s(e.resizedCoords),this.setCtxStyles(e),this.context.font=e.resizedFont,this.context.fillText(e.text,e.resizedCoords.resizedX1,e.resizedCoords.resizedY1),this.createDrawingSelection(e);return}this.createDrawingSelection(e)}this.setCtxStyles(e),this.context.fillText(e.text,e.coords.x1,e.coords.y1);break;case"line":if(this.selectedDrawingIndex===t&&this.actions.resizing){this.setCtxStyles(e),this.context.stroke(e.resizedPath),this.createDrawingSelection(e);return}this.setCtxStyles(e),this.context.stroke(e.path),this.selectedDrawingIndex===t&&this.createDrawingSelection(e)}})}targetIs(e,t){return!!t.id&&t.id===e.id||!!t.className&&t.className===e.className}}new n("drawing-board");
//# sourceMappingURL=index.202fbc4e.js.map
